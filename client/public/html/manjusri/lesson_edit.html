<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>全国共修</title>

    <link href="../../assets/css/reset.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../assets/css/jw.css" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    {{>sharepage}}
    <style>
        .left {
            position: absolute;
            left: 0;
            top: 0;
            width: 100px;
        }

        .center {

            width: auto; /*如果没有这一句，那么，center这个div的文字就不会自动换行*/
            margin: 0 90px 15px 100px;

        }
		.center input{
			width:100%;
		}

        .right {
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;

        }
		.add_name,.del_name{
			padding: 6px 0 0 0 ;
		}
		.add_name img,.del_name img{
			with:27px;
			height:27px;
		}
		.input_tips{
			width: auto;
            margin: 0 0 0px 100px;
			position: relative;
			top:-12px;
			font-size: 14px;
			color: #6d6d6d;
		}
		.input_tips span{
			color: #ff0000;
		}
		.name_list{
			position: relative;
		}
		.name_history{
			position: absolute;
			top:40px;
			z-index: 2;
			left: 100px;
			width: 50%;
		}
		.name_history ul{
			background: #ffffff;
			box-shadow: 0 0 10px;
			padding: 10px 0;
			margin: 0 20px 0 0;
		}
		.name_history li{
			line-height: 40px;
			height: 40px;
			padding: 0 15px;
			
		}
    </style>

</head>
<body>
<div class="wrapper container-fluid bcfcf6d4 w100v ">
    <div class="mlr-15">
        <img src="../../assets/images/img_gongxiu_2.jpg" alt="" class="w100-">
    </div>
    <ul class="mlr-15 mb0">
		<li class="p-r w100- bcfff bb1sccc ofa">
			<div class="left ">
				<img src="{{lesson.img}}" alt="" class="w50 br45 ml20 mt20">
			</div>
			<div class="center pl20">
				<p class="pt20 fw7">{{lesson.name}}</p>
				<p class="fs12 c999">
					<span id="join_{{lesson._id}}">{{join}}</span>人共修
					<span id="practice_{{lesson._id}}">{{practice}}</span>{{lesson.unit}}
				</p>
			</div>

			<div class="pb20 plr15 panel mb0">
				<div class="p-r w100- fs16">
					<div class="left l35"><img src="../../assets/images/a.png" alt="" class="w20"> 报数</div>
					<div class="center l35">
						<input id="input_{{lesson._id}}" type="number" class="w100- h35 bceee bn br5 pl5">
					</div>
				   <!-- <div class="right tr pr30">{{lesson.unit}}</div>-->
					<div class="right l35">遍</div>
				</div>
				<div class="mt15 p-r w100- fs16 user_name2">
					<div class="name_list">
						<div class="left l35 wp3"><img src="../../assets/images/a.png" alt="" class="w20"> 学生姓名</div>
						<div class="center l35">
							<input id="input_{{lesson._id}}"  class="input_name w100- h35 bceee bn br5 pl5">
						</div>
					   <!-- <div class="right tr pr30">{{lesson.unit}}</div>-->
						<div class="add_name right"><img src="../../images/btn_add_name.png"></div>
						<div class="name_history dn">
							<ul>
								<li>张三</li>
								<li>李四</li>
								<li>王五</li>
							</ul>
						</div>
					</div>
					<div class="user_name user_name2 wp10">
						<div class='name_list'>
							<div class='center l35'>
								<input id='input_{{lesson._id}}' class='input_name w100- h35 bceee bn br5 pl5' value="" /></div>
								<div class='del_name right'><img src='../../images/btn_del_name.png'>
							</div>
							<div class="name_history dn">
								<ul>
									<li>张三</li>
									<li>李四</li>
									<li>王五</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
				<div class="mt15 p-r w100- fs16">
				   <div class="input_tips">每格限填<span>1</span>人名字</div>
				</div>
				<div class="l30">
					<img src="../../assets/images/a.png" alt="" class="w20"> 回向
				</div>
				<div class="plr30">
					<textarea class="form-control mt10 oln bceee mb20" rows="4"></textarea>
					<button type="button" class="db bn br5 bcf5ecc3 w100- h30 sub "
							onclick="announce('{{links.self}}', '{{lesson._id}}')">确认
					</button>
				</div>
			</div>
		</li>
    </ul>
    <div class="mlr-15 bcfff pb30 plr30">
        <p class="tc fs20 fw7 l60 mb0 pt10">共修功德</p>
        <p class="ti2 l30 ffht ">万人共造善恶因,每人均得万人果。众人共修之功德是各人所修功德的总和,也就是说,如果万人同时参加共修,每个人于共修期间所造善业都将增长一万倍。</p>
    </div>

    <!-- 页脚 -->
    <footer>
        <figure>
            <img src="../../assets/images/logo.png" alt="">
        </figure>
        <div class="copyright">
            Copyright @2016 The Jin Yin Temple
        </div>
    </footer>
    {{>footmenu}}
</div>

<script src="../../js/jquery-3.1.1.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        //$(".flip").click(function () {
//            $(this).closest("div").siblings(".panel").slideToggle();
//            if ($(this).siblings(".glyphicon").hasClass("glyphicon-chevron-right")) {
//                $(this).siblings(".glyphicon").removeClass("glyphicon-chevron-right").addClass("glyphicon-chevron-down");
//            } else {
//                $(this).siblings(".glyphicon").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-right");
//            }
//        })
		
		//点击添加名称输入框
		var namen=0;
		$(".add_name").bind("click",function(){
			if(namen<2){
				$(".user_name").append("<div class='name_list'><div class='center l35'><input id='input_{{lesson._id}}' class='input_name w100- h35 bceee bn br5 pl5'  /></div><div class='del_name right'><img src='../../images/btn_del_name.png'></div><div class='name_history dn'><ul><li>张三</li><li>李四</li><li>王五</li></ul></div></div>");
				namen++;
			}else{
				alert("最多添加三个名称！");
			}
		});
		$(".user_name2").on("click",".del_name",function(){
			$(this).parent('.name_list').remove();
			namen--;
		});
		
		$(".user_name2").on("click",".input_name",function(){
			var li_n=0;
			$(this).parents(".name_list").find("li").each(function(){
				li_n++;
			});
			if(li_n>1){
			 	$(this).parents(".name_list").find(".name_history").show(); 
			}else{
				$(this).parents(".name_list").find(".name_history").hide();
			}
			
		});
		$(".user_name2").on("click",".name_history li",function(){
			var nameList=$(this).text();
			$(this).parents(".name_list").find("input").attr("value",nameList);
			$(".name_history").hide();
		});
		
    });

    function announce(url, inputid) {
        var num = Math.round($("#input_" + inputid).val() * 1);
        if (num == 0) return;

        $.ajax({
            url: url,
            method: 'POST',
            contentType: "application/json",
            data: JSON.stringify({num: num}),
            success: function () {
                $.ajax({
                    url: url,
                    method: 'GET',
                    contentType: "application/json",
                    success: function (result) {
                        $("#join_" + inputid).text(result.data.join);
                        $("#practice_" + inputid).text(result.data.practice);
                        $("#flip_" + inputid).click();
                        $("#input_" + inputid).val('');
                    }
                });
            }
        })
    }
</script>
</body>
</html>